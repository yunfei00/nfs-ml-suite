"""Dataset builder (template)

V1 training expects processed NPZ containing X and Y arrays.

If you have legacy data generated by earlier scripts (CSV or NPZ with different keys),
implement a one-time converter here.

Recommended workflow:
- put legacy files under: NFS_WORKDIR/raw/...
- convert into: NFS_WORKDIR/processed/<task>/train.npz and val.npz
"""

from __future__ import annotations
from pathlib import Path
import numpy as np

def save_processed_npz(out_path: Path, X: np.ndarray, Y: np.ndarray, meta: dict | None = None) -> None:
    out_path.parent.mkdir(parents=True, exist_ok=True)
    if meta is None:
        np.savez(out_path, X=X.astype(np.float32), Y=Y.astype(np.float32))
    else:
        np.savez(out_path, X=X.astype(np.float32), Y=Y.astype(np.float32), meta=np.array(meta, dtype=object))

# Example stub:
def convert_legacy_npz(in_path: Path, out_path: Path, x_key="X", y_key="Y") -> None:
    d = np.load(in_path, allow_pickle=True)
    X = d[x_key]
    Y = d[y_key]
    save_processed_npz(out_path, X, Y, meta={"source": str(in_path)})

if __name__ == "__main__":
    raise SystemExit("Use this module as a template for one-time conversion.")
